name: Integration

on: [push, pull_request]

jobs:
  api-sipnet:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: |
          echo 'PECAN_VERSION=develop' > .env
          echo 'BETY_VERSION=develop' >> .env
          docker-compose up -d postgres
          docker run --rm --network pecan_pecan pecan/db
          docker-compose run --rm bety user carya illinois "Demo admin" carya@example.com 1 1
          docker run --rm --network pecan_pecan --volume pecan_pecan:/data --env FQDN=docker pecan/data:develop
          docker-compose up -d
          curl localhost:8000/api/workflows/ --user carya:illinois -H "Content-Type:application/xml" --data-binary "@tests/api.sipnet.xml"
